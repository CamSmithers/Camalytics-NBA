---
title: "Analysis of Models"
author: "Cam Smithers"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(readr)
library(broom)
```

# Win Loss Models

```{r}
#WinLoss Model 1
winloss_v1_folder <- "/Users/camsmithers/Desktop/NBA Project/Main/Model Predictions/WinLoss1"
winloss_v1_files <- list.files(winloss_v1_folder, pattern = "\\.csv",
                               full.names = TRUE)
```

## Win Loss: Version 1

```{r}
winloss_v1_outcome_data <- winloss_v1_files %>%
    lapply(read_csv) %>%
    bind_rows()
# Creating intermediate data frame to add 
winloss_v1_intermediate <- winloss_v1_outcome_data %>%
    select(team_date, team_team, winloss_team_prob) %>%
    rename("team_int" = "team_team", "winloss_team_prob_int" = "winloss_team_prob")

winloss_v1_outcome_data <- winloss_v1_outcome_data %>%
    left_join(winloss_v1_intermediate, by = c("team_opponent" = "team_int", "team_date" = "team_date")) %>%
    rename("winloss_opponent_team_prob" = "winloss_team_prob_int")

winloss_v1_outcome_data <- winloss_v1_outcome_data %>%
    mutate(winloss_model_pick = ifelse(winloss_team_prob > winloss_opponent_team_prob, 1, 0)) %>%
    mutate(winloss_model_range = winloss_team_prob - winloss_opponent_team_prob)

winloss_all_team_data <- all_team_data %>%
    select(team_team, team_date, team_winloss, team_favored)

winloss_v1_outcome_data <- winloss_v1_outcome_data %>%
    left_join(winloss_all_team_data, by = c("team_team", "team_date")) %>%
    filter(!is.na(team_winloss)) %>%
    mutate(my_predictions = ifelse(winloss_model_pick == team_winloss, 1, 0)) %>%
    mutate(fd_predictions = ifelse(team_favored == team_winloss, 1, 0))

winloss_v1_outcome_data <- winloss_v1_outcome_data %>%
    mutate(prediction_range = case_when(
        winloss_team_prob < 100 & winloss_team_prob > 70.0 ~ "Safe",
        winloss_team_prob < 70.0 & winloss_team_prob > 50.0 ~ "Risky",
        winloss_team_prob < 50.0 ~ "Unsafe"
    ))
```

### Win Loss: Version 1: Plots

```{r}
winloss_v1_plot <- ggplot(winloss_v1_outcome_data, aes(x = winloss_team_prob, fill = as.factor(team_winloss))) + 
    geom_histogram(color = "black") + 
    scale_y_continuous(breaks = seq(0, 20, by = 2))

winloss_v1_plot

winloss_v1_plot2 <- ggplot(winloss_v1_outcome_data, aes(x = as.factor(team_winloss), fill = as.factor(prediction_range))) +
    geom_bar(position = "dodge", color = "black") + 
    geom_text(
    stat = "count",
    aes(label = after_stat(count)),
    position = position_dodge(width = 0.9),
    vjust = -0.3  # Position text above bars
  ) +
    scale_y_continuous(breaks = seq(0, 80, by = 10)) +
    scale_x_discrete(labels = c("0" = "Loss", "1" = "Win")) +
    scale_fill_brewer(palette = "Set3",
                      name = "Prediction Range") + 
    labs(
        x = "Losses vs Wins",
        y = "Amount of Losses or Wins")

winloss_v1_plot2


```

# Upset Models

```{r}
upset_v1_folder <- "/Users/camsmithers/Desktop/NBA Project/Main/Model Predictions/Upset1"
upset_v1_files <- list.files(upset_v1_folder, pattern = "\\.csv",
                             full.names = TRUE)

upset_v2_folder <- "/Users/camsmithers/Desktop/NBA Project/Main/Model Predictions/Upset2"
upset_v2_files <- list.files(upset_v2_folder, pattern = "\\.csv",
                             full.names = TRUE)
```

## Upset: Version 1

```{r}
upset_v1_outcome_data <- upset_v1_files %>%
    lapply(read_csv) %>%
    bind_rows()
```

## Upset: Version 2

```{r}
upset_v2_outcome_data <- upset_v2_files %>%
    lapply(read_csv) %>%
    bind_rows()
```

# Close Win Models

```{r}
close_win_v1_folder <- "/Users/camsmithers/Desktop/NBA Project/Main/Model Predictions/CloseWin1"
close_win_v1_files <- list.files(close_win_v1_folder, pattern = "\\.csv",
                                 full.names = TRUE)

close_win_v3_folder <- "/Users/camsmithers/Desktop/NBA Project/Main/Model Predictions/CloseWin3"
close_win_v3_files <- list.files(close_win_v3_folder, pattern = "\\.csv",
                                 full.names = TRUE)
```
