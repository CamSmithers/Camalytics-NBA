---
title: "Multinomial Regression"
author: "Cam Smithers"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Team Outcome Analysis

## Loading Packages

```{r}
library(readxl)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(broom)
library(purrr)
library(parameters)
library(nnet)
```

# Data Cleaning

## Loading in Data

```{r warning=FALSE}
#Running script that contains all data (teams and players)
source("/Users/camsmithers/Desktop/NBA Project/Main/Data/DataScript.R")

#Joining all team data into one data frame
outcome_team_data <- team_traditional %>%
    left_join(team_advanced, by = c("team", 'date')) %>% 
    left_join(team_misc, by = c("team", "date")) %>%
    left_join(team_scoring, by = c("team", "date")) %>%
    left_join(team_outcome, by = c("team", "date"))
```

## Data Cleaning 1: General Cleaning

1.  Removing duplicates, renaming, and re-ordering
2.  Adding the opposing team and some of their statistics
3.  Re-ordering columns for better visualization when checking data

```{r}
outcome_team_data <- outcome_team_data %>%
    dplyr::select(-opponent, -opponent.y, -opponent.x.x, -opponent.y.y, -home, -home.y, -home.x.x,
           -home.y.y, -blk.y, -pf.y) %>% #Removing duplicated columns
    rename("opponent" = "opponent.x", "blk" = "blk.x", "pf" = "pf.x", "home" = "home.x") %>% 
    dplyr::select(team, home, everything()) #Re-ordering variables for better visualization
team_temporary_df <- outcome_team_data %>% #Temporary data frame used add opponents' points scored
    dplyr::select(team, opponent, date, pts) %>%
    rename("team_1" = "team", "team_2" = "opponent")

outcome_team_data <- outcome_team_data %>% #Joining opponent points to original data frame
    left_join(team_temporary_df, by = c("team" = "team_2", "date")) %>%
    rename("opponent_pts" = "pts.y", "pts" = "pts.x") %>%
    dplyr::select(-team_1)

outcome_team_data <- outcome_team_data %>% #Re-ordering for better visualization
    dplyr::select(date, home, team, pts, opponent, opponent_pts, everything()) %>%
    rename_with(~ paste0("team_", .)) #Adding _team to each observation for easier recognition of variable for later cleaning, model building, and joins
```

## Data Cleaning 2: Adding Important Outcomes

```{r}
outcome_team_data <- outcome_team_data %>%
    mutate(team_outcome = case_when(
        team_plusminus <= 10 & team_plusminus > 0 ~ 1,
        team_plusminus < 0 & team_plusminus >= -10 ~ 2,
        team_plusminus > 10 ~ 3,
        team_plusminus < -10 ~ 4
    )) %>%
    mutate(team_blowout_win = ifelse(team_outcome == 1, 1, 0),
           team_close_win = ifelse(team_outcome == 2, 1, 0),
           team_close_loss = ifelse(team_outcome == 3, 1, 0),
           team_blowout_loss = ifelse(team_outcome == 4, 1, 0)) %>%
    mutate(team_win = ifelse(team_outcome == 1 | team_outcome == 2, 1, 0),
           team_loss = ifelse(team_outcome == 3 | team_outcome == 4, 1, 0)) %>%
    mutate(team_point_differential = abs(team_plusminus)) %>%
    mutate(team_outcome = factor(team_outcome,
                                 levels = c(1, 2, 3, 4),
                                 labels = c("Close Win", "Close Loss", "Blowout Win", "Blowout Loss")))
```

## Data Cleaning 3: Team Averages

```{r}
average_outcome_team <- outcome_team_data %>%
    group_by(team_team) %>%
    summarize(
        team_pts = round(mean(team_pts, na.rm = TRUE), 2), 
        team_reb = round(mean(team_reb, na.rm = TRUE), 2),
        team_ast = round(mean(team_ast, na.rm = TRUE), 2),
        team_offrating = round(mean(team_offrating, na.rm = TRUE), 2),
        team_defrating = round(mean(team_defrating, na.rm = TRUE), 2),
        team_netrating = round(mean(team_netrating, na.rm = TRUE), 2),
        team_plusminus = round(mean(team_plusminus, na.rm = TRUE), 2)
    ) %>%
    rename_with(~ paste0("avg_", .))

opponent_average_outcome_team <- outcome_team_data %>%
    group_by(team_team) %>%
    summarize(
        team_pts = round(mean(team_pts, na.rm = TRUE), 2), 
        team_reb = round(mean(team_reb, na.rm = TRUE), 2),
        team_ast = round(mean(team_ast, na.rm = TRUE), 2),
        team_offrating = round(mean(team_offrating, na.rm = TRUE), 2),
        team_defrating = round(mean(team_defrating, na.rm = TRUE), 2),
        team_netrating = round(mean(team_netrating, na.rm = TRUE), 2),
        team_plusminus = round(mean(team_plusminus, na.rm = TRUE), 2)
    ) %>%
    rename_with(~ paste0("avg_opponent_", .))

outcome_team_data <- outcome_team_data %>%
    left_join(average_outcome_team, by = c("team_team" = "avg_team_team")) %>%
    left_join(opponent_average_outcome_team, by = c("team_opponent" = "avg_opponent_team_team"))

```

------------------------------------------------------------------------

# Modeling & Data Cleaning

## Model Testing 1:

```{r}


```
